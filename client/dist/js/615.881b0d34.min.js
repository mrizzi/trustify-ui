"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([[615],{1349:(e,t,n)=>{n.d(t,{n:()=>l});var a=n(63696),r=n(84348);const l=({paginationProps:e,isTop:t,isCompact:n=!1,noMargin:l=!1,idPrefix:i=""})=>a.createElement(r.d,{id:`${i?`${i}-`:""}pagination-${t?"top":"bottom"}`,variant:t?r.A.top:r.A.bottom,isCompact:n,...e,widgetId:"pagination-id"})},75855:(e,t,n)=>{n.d(t,{q:()=>m});var a=n(63696),r=n(63863),l=n(97157),i=n(2408),o=n(92411),c=n(60087),s=n(45960);const m=()=>a.createElement(r.p,{variant:r.s.sm},a.createElement(l.q,{icon:c.Ay,color:s.D.value}),a.createElement(i.h,{headingLevel:"h2",size:"lg"},"Unable to connect"),a.createElement(o.h,null,"There was an error retrieving data. Check your connection and try again."))},62520:(e,t,n)=>{n.d(t,{nJ:()=>h,Ze:()=>y,Oi:()=>v});var a=n(63696),r=n(59394),l=n(99135),i=n(28516),o=n(9425),c=n(3629),s=n(75855),m=n(63863),u=n(97157),d=n(2408),p=n(92411),E=n(28469);const b=({title:e,description:t})=>a.createElement(m.p,{variant:m.s.sm},a.createElement(u.q,{icon:E.Ay}),a.createElement(d.h,{headingLevel:"h2",size:"lg"},e),t&&a.createElement(p.h,null,t)),g=()=>a.createElement(b,{title:"No data available",description:"No data available to be shown here."}),h=({numRenderedColumns:e,isLoading:t=!1,isError:n=!1,isNoData:m=!1,errorEmptyState:u=null,noDataEmptyState:d=null,children:p})=>a.createElement(a.Fragment,null,t?a.createElement(i.N,null,a.createElement(o.Tr,null,a.createElement(c.Td,{colSpan:e},a.createElement(r.a,null,a.createElement(l.y,{size:"xl"}))))):n?a.createElement(i.N,{"aria-label":"Table error"},a.createElement(o.Tr,null,a.createElement(c.Td,{colSpan:e},a.createElement(r.a,null,u||a.createElement(s.q,null))))):m?a.createElement(i.N,{"aria-label":"Table error"},a.createElement(o.Tr,null,a.createElement(c.Td,{colSpan:e},a.createElement(r.a,null,d||a.createElement(g,null))))):p);var f=n(77819);const y=({numColumnsBeforeData:e,numColumnsAfterData:t,children:n})=>a.createElement(a.Fragment,null,Array(e).fill(null).map(((e,t)=>a.createElement(f.Th,{screenReaderText:`before-data-${t}`,key:t}))),n,Array(t).fill(null).map(((e,t)=>a.createElement(f.Th,{screenReaderText:`after-data-${t}`,key:t})))),v=({isExpansionEnabled:e=!1,expandableVariant:t,isSelectionEnabled:n=!1,propHelpers:{getSingleExpandButtonTdProps:r,getSelectCheckboxTdProps:l},item:i,rowIndex:o,children:s})=>a.createElement(a.Fragment,null,e&&"single"===t?a.createElement(c.Td,{...r({item:i,rowIndex:o})}):null,n?a.createElement(c.Td,{...l({item:i,rowIndex:o})}):null,s)},23384:(e,t,n)=>{n.r(t),n.d(t,{default:()=>te});var a=n(63696),r=n(95285),l=n.n(r),i=n(77635),o=n(68430),c=n(1180),s=n(72785),m=n(20653),u=n(35048),d=n(4433),p=n(93962),E=n(1865),b=n(10833),g=n(40319),h=n(16646),f=n(9425),y=n(77819),v=n(28516),T=n(3629),C=n(62101),I=n(38139),k=n(87514);const D=({isOpen:e,title:t,titleIconVariant:n,message:r,confirmBtnLabel:l,cancelBtnLabel:o,inProgress:c,confirmBtnVariant:s,onClose:m,onConfirm:u,onCancel:d})=>{const p=a.createElement(i.$n,{id:"confirm-dialog-button",key:"confirm","aria-label":"confirm",variant:s,isDisabled:c,onClick:u},l),b=d?a.createElement(i.$n,{key:"cancel",id:"confirm-cancel-button","aria-label":"cancel",variant:i.Ak.link,isDisabled:c,onClick:d},o):void 0;return a.createElement(E.a,{id:"confirm-dialog",variant:E.d.small,title:t,titleIconVariant:n,isOpen:e,onClose:m,"aria-label":"Confirm dialog",actions:d?[p,b]:[p]},r)};var P=n(50705),S=n(39155),w=n(3715),A=n(26667),K=n(77347),N=n(40752);const x="importers";var $=n(34066),L=n(87043),O=n(26615),F=n(28338),R=n(70045),B=n(19766),V=n(93302),q=n(60087),j=n(55092),z=n(47538),M=n(84632),U=n(57481);const _=({preset:e,status:t,icon:n,className:r="",label:l,tooltipCount:i=0})=>{const o={Canceled:{icon:a.createElement(M.Ay,null),status:"info",label:"Canceled"},Completed:{icon:a.createElement(V.Ay,null),status:"success",label:"Completed"},Error:{icon:a.createElement(q.Ay,null),status:"danger",label:"Error"},Failed:{icon:a.createElement(q.Ay,null),status:"danger",label:"Failed"},InProgress:{icon:a.createElement(j.Ay,null),status:"info",label:"In-progress"},NotStarted:{icon:a.createElement(M.Ay,null),label:"Not started"},Ok:{icon:a.createElement(V.Ay,null),status:"success"},Scheduled:{icon:a.createElement(z.Ay,null),status:"info",label:"Scheduled"},Unknown:{icon:a.createElement(U.Ay,null)}},c=e&&o[e];return a.createElement(F.s,{flexWrap:{default:"nowrap"},spaceItems:{default:"spaceItemsSm"}},a.createElement(R.Z,null,a.createElement((({children:e})=>c?.tooltipMessage?a.createElement(O.m,{content:c?.tooltipMessage},e):a.createElement(a.Fragment,null,e)),null,a.createElement(B.I,{status:t||c?.status,className:r},n||c?.icon||a.createElement(U.Ay,null)))),a.createElement(R.Z,null,l||c?.label))};var J=n(1349),Z=n(62520),H=n(70611),W=n(86820),X=n(90929),Y=n(59842);const G=({value:e})=>a.createElement(X.k,{"aria-label":"Progress of Importer ",value:e.current,min:0,max:e.total,measureLocation:Y.Ri.inside,size:X.j.sm}),Q=new Map([["waiting","Scheduled"],["running","InProgress"]]),ee=({state:e})=>a.createElement(_,{preset:(e=>{if(Q.has(e)){const t=Q.get(e);if(t)return t}return"NotStarted"})(e)}),te=()=>{const{pushNotification:e}=a.useContext(P.K),[t,n]=a.useState(null),[r,l]=a.useState(null),E=(e,t)=>{l(e),n(t)},[b,k]=a.useState(1e4),{importers:O,isFetching:F,fetchError:R}=((e=!1,t=5e3)=>{const{isLoading:n,error:a,refetch:r,data:l}=(0,S.I)({queryKey:[x],queryFn:()=>(0,N.wb)({client:K.S}),refetchInterval:!e&&t});return{importers:l?.data||[],isFetching:n,fetchError:a,refetch:r}})(!1,b);a.useEffect((()=>{O.some((e=>"running"===e.state))?k(5e3):1e4!==b&&k(1e4)}),[O]);const{mutate:B}=(()=>{const t=(0,w.jE)();return(0,A.n)({mutationFn:e=>(0,N.U0)({client:K.S,path:{name:e.importerName},body:e.configuration}),onSuccess:(e,n)=>{t.invalidateQueries({queryKey:[x]})},onError:t=>{e({title:"Error while enabling/disabling the Importer",variant:"danger"})}})})(),V=(e,t)=>{const n=Object.keys(e.configuration??{})[0],a={...e.configuration[n],disabled:!t},r={[n]:a};B({importerName:e.name,configuration:r})},q=()=>{e({title:"Importer scheduled to run as soon as possible",variant:"success"})},j=t=>{e({title:(0,$.sO)(t),variant:"danger"})},z=(0,H.vY)({tableName:"importers-table",idProperty:"name",items:O,columnNames:{name:"Name",type:"Type",description:"Description",source:"Source",period:"Period",state:"State"},hasActionsColumn:!0,isSortEnabled:!0,sortableColumns:["name"],getSortValues:e=>({name:e.name}),isPaginationEnabled:!0,isExpansionEnabled:!0,expandableVariant:"single",isFilterEnabled:!0,filterCategories:[{categoryKey:"name",title:"Name",type:L.RJ.search,placeholderText:"Search by name...",getItemValue:e=>e.name||""}]}),{currentPageItems:M,numRenderedColumns:U,propHelpers:{toolbarProps:_,filterToolbarProps:W,paginationToolbarItemProps:X,paginationProps:Y,tableProps:Q,getThProps:te,getTrProps:ae,getTdProps:re},expansionDerivedState:{isCellExpanded:le}}=z;let ie;switch(r){case"enable":ie={title:"Enable Importer",titleIconVariant:"info",message:`Are you sure you want to enable the Importer ${t?.name}?`,confirmBtnVariant:i.Ak.primary,confirmBtnLabel:"Enable",cancelBtnLabel:"Cancel"};break;case"disable":ie={title:"Disable Importer",titleIconVariant:"info",message:`Are you sure you want to disable the Importer ${t?.name}?`,confirmBtnVariant:i.Ak.primary,confirmBtnLabel:"Disable",cancelBtnLabel:"Cancel"};break;case"run":ie={title:"Run Importer",titleIconVariant:"info",message:`Are you sure you want to run the Importer ${t?.name}?`,confirmBtnVariant:i.Ak.primary,confirmBtnLabel:"Run",cancelBtnLabel:"Cancel"};break;default:ie=null}return a.createElement(a.Fragment,null,a.createElement(o.d8,{variant:o.zC.light},a.createElement(c.n,null,a.createElement(s.E,{component:"h1"},"Importers"))),a.createElement(o.d8,null,a.createElement("div",{style:{backgroundColor:"var(--pf-v5-global--BackgroundColor--100)"}},a.createElement(m.M,{..._},a.createElement(u.P,null,a.createElement(L.Us,{showFiltersSideBySide:!0,...W}),a.createElement(d.T,{...X},a.createElement(J.n,{idPrefix:"importer-table",isTop:!0,paginationProps:Y})))),a.createElement(g.X,{...Q,"aria-label":"Importer table"},a.createElement(h.d,null,a.createElement(f.Tr,null,a.createElement(Z.Ze,{...z},a.createElement(y.Th,{...te({columnKey:"name"})}),a.createElement(y.Th,{...te({columnKey:"type"})}),a.createElement(y.Th,{...te({columnKey:"description"})}),a.createElement(y.Th,{...te({columnKey:"source"})}),a.createElement(y.Th,{...te({columnKey:"period"})}),a.createElement(y.Th,{...te({columnKey:"state"})})))),a.createElement(Z.nJ,{isLoading:F,isError:!!R,isNoData:0===O.length,numRenderedColumns:U},M?.map(((e,t)=>{const n=Object.keys(e.configuration??{})[0],r=e.configuration[n],l=!1===r?.disabled;return a.createElement(v.N,{key:e.name},a.createElement(f.Tr,{...ae({item:e})},a.createElement(Z.Oi,{...z,item:e,rowIndex:t},a.createElement(T.Td,{width:15,modifier:"truncate",...re({columnKey:"name"})},e.name),a.createElement(T.Td,{width:10,modifier:"truncate",...re({columnKey:"type"})},n),a.createElement(T.Td,{width:20,modifier:"truncate",...re({columnKey:"description"})},r?.description),a.createElement(T.Td,{width:20,modifier:"truncate",...re({columnKey:"source"})},r?.source),a.createElement(T.Td,{width:10,modifier:"truncate",...re({columnKey:"period"})},r?.period),a.createElement(T.Td,{width:10,modifier:"truncate",...re({columnKey:"state"})},e.state&&l?"running"===e.state&&e.progress?a.createElement(G,{value:e.progress}):a.createElement(ee,{state:e.state}):a.createElement(p.J,{color:"orange"},"Disabled")),a.createElement(T.Td,{isActionCell:!0},a.createElement(C.G,{items:[...l?[{title:"Run",onClick:()=>{E("run",e)}}]:[],...l?[{title:"Disable",onClick:()=>{E("disable",e)}}]:[{title:"Enable",onClick:()=>{E("enable",e)}}]]})))),le(e)?a.createElement(f.Tr,{isExpanded:!0},a.createElement(T.Td,{colSpan:7},a.createElement("div",{className:"pf-v5-u-m-md"},a.createElement(I.g,null,a.createElement(ne,{importer:e}))))):null)})))),a.createElement(J.n,{idPrefix:"importer-table",isTop:!1,isCompact:!0,paginationProps:Y}))),r&&ie&&a.createElement(D,{...ie,isOpen:!0,onCancel:()=>l(null),onClose:()=>l(null),onConfirm:()=>{if(t)switch(r){case"enable":V(t,!0);break;case"disable":V(t,!1);break;case"run":e=t.name,(0,N.Nz)({client:K.S,path:{name:e},body:!0}).then(q).catch(j)}var e;n(null),l(null)}}))},ne=({importer:e})=>{const[t,n]=a.useState([]),[r,o]=a.useState(!1),c=()=>o(!r),{result:{data:s},isFetching:p,fetchError:C}=((e,t=!1)=>{const{data:n,isLoading:a,refetch:r,error:l}=(0,S.I)({queryKey:[x,e,"reports"],queryFn:()=>(0,N.e9)({client:K.S,path:{name:e}}),refetchInterval:!t&&5e3});return{result:{data:n?.data?.items||[],total:n?.data?.total??0},isFetching:a,fetchError:l,refetch:r}})(e.name),I=a.useMemo((()=>{const t={isRunning:!0,id:"root",startDate:void 0,endDate:void 0,duration:e.progress?.estimatedSecondsRemaining?1e3*e.progress?.estimatedSecondsRemaining:void 0,numberOfItems:e.progress?.current,error:void 0,messages:void 0},n=s.map((e=>{let t;if(e.report?.startDate&&e.report.endDate){const n=l()(e.report.startDate);t=l()(e.report.endDate).diff(n)}return{isRunning:!1,id:e.id,startDate:e.report?.startDate,endDate:e.report?.endDate,duration:t,numberOfItems:e.report?.numberOfItems,error:e.error??void 0,messages:e.report?.messages}}));return[..."running"===e.state?[t]:[],...n]}),[e,s]),D=(0,H.vY)({variant:"compact",tableName:"report-table",idProperty:"id",items:I,columnNames:{startDate:"Start date",endDate:"End date",numberOfItems:"Number of items",status:"Status",duration:"Duration"},isPaginationEnabled:!0,initialItemsPerPage:5,isSortEnabled:!0,sortableColumns:["startDate","endDate"],initialSort:{columnKey:"startDate",direction:"desc"},getSortValues:e=>({startDate:!e.startDate||l()(e.startDate).valueOf(),endDate:!e.endDate||l()(e.endDate).valueOf()}),isFilterEnabled:!1,isExpansionEnabled:!1}),{currentPageItems:P,numRenderedColumns:w,propHelpers:{toolbarProps:A,tableProps:L,paginationToolbarItemProps:O,paginationProps:F,getThProps:R,getTrProps:B,getTdProps:V}}=D;return a.createElement(a.Fragment,null,a.createElement(m.M,{...A},a.createElement(u.P,null,a.createElement(d.T,{...O},a.createElement(J.n,{idPrefix:"report-table",isTop:!0,paginationProps:F})))),a.createElement(g.X,{...L,"aria-label":"Report table"},a.createElement(k.H,null,"Importer reports"),a.createElement(h.d,null,a.createElement(f.Tr,null,a.createElement(Z.Ze,{...D},a.createElement(y.Th,{...R({columnKey:"startDate"})}),a.createElement(y.Th,{...R({columnKey:"endDate"})}),a.createElement(y.Th,{...R({columnKey:"numberOfItems"})}),a.createElement(y.Th,{...R({columnKey:"status"})}),a.createElement(y.Th,{...R({columnKey:"duration"})})))),a.createElement(Z.nJ,{isLoading:p,isError:!!C,isNoData:0===I?.length,numRenderedColumns:w},P?.map(((e,t)=>a.createElement(v.N,{key:e.id},a.createElement(f.Tr,{...B({item:e})},a.createElement(Z.Oi,{...D,item:e,rowIndex:t},a.createElement(T.Td,{width:15,modifier:"truncate",...V({columnKey:"startDate"})},(0,$.r6)(e.startDate)),a.createElement(T.Td,{width:15,modifier:"truncate",...V({columnKey:"endDate"})},(0,$.r6)(e.endDate)),a.createElement(T.Td,{width:15,modifier:"truncate",...V({columnKey:"numberOfItems"})},e.numberOfItems),a.createElement(T.Td,{width:30,modifier:"truncate",...V({columnKey:"status"})},e.isRunning?a.createElement(ee,{state:"running"}):a.createElement((({children:t})=>e.messages?a.createElement(i.$n,{isInline:!0,variant:"link",onClick:()=>{const t=(a=e.messages??{},Object.entries(a).map((([e,t])=>Object.entries(t).map((([t,n])=>({title:`${e.charAt(0).toUpperCase()+e.slice(1)}: "${t}"`,body:n.map((e=>{let t;switch(e.severity){case"none":t=W.bv.green;break;case"low":t=W.bv.cyan;break;case"medium":t=W.bv.yellow;break;case"high":t=W.bv.lightBlue;break;case"critical":t=W.bv.red}return`${t??""}${e.severity.charAt(0).toUpperCase()+e.severity.slice(1)}: ${W.bv.defaultForegroundColorAtStartup} ${e.message}`})).join(W.bv.endLine)}))).map((e=>`${W.bv.underline}${e.title}${W.bv.reset}${W.bv.endLine}${e.body}`)).join(`${W.bv.endLine}${W.bv.endLine}`))));var a;n(t),c()}},t):t),null,e.error?a.createElement(_,{preset:"Failed",label:e.error}):a.createElement(_,{preset:"Completed",label:"Finished successfully"}))),a.createElement(T.Td,{width:25,modifier:"truncate",...V({columnKey:"duration"})},e.duration?e.isRunning?`Time remaining: ${l().duration(e.duration).humanize()}`:`Run for: ${l().duration(e.duration).humanize()}`:"")))))))),a.createElement(J.n,{idPrefix:"report-table",isTop:!1,isCompact:!0,paginationProps:F}),a.createElement(E.a,{title:"Log",variant:"large",isOpen:r,onClose:c,actions:[a.createElement(i.$n,{key:"cancel",variant:"link",onClick:c},"Close")]},a.createElement(b.rW,{hasLineNumbers:!1,height:400,data:t,theme:"dark",toolbar:a.createElement(m.M,null,a.createElement(u.P,null,a.createElement(d.T,null,a.createElement(b.ht,{placeholder:"Search value",minSearchChars:1}))))})))}}}]);
//# sourceMappingURL=615.881b0d34.min.js.map