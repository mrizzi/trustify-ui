"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([["144"],{54774:function(e,a,r){r.d(a,{Co:()=>u,Cu:()=>i,Hb:()=>p});var t=r(70233),s=r(44072);r(23475);let l="/api",o=`${l}/v2/advisory`,n=`${l}/v2/sbom`,d=e=>{let a="application/json";return e.name.endsWith(".bz2")?a="application/json+bzip2":e.name.endsWith(".gz")&&(a="application/json+bzip2"),a},i=(e,a)=>{let r=e.get(s.TB);return t.Z.post(`${o}`,r,{...a,headers:{"Content-Type":d(r)}})},p=(e,a)=>{let r=e.get(s.TB);return t.Z.post(`${n}`,r,{...a,headers:{"Content-Type":d(r)}})},u=e=>t.Z.get(`${n}/${e}/license-export`,{responseType:"arraybuffer",headers:{Accept:"text/plain",responseType:"blob"}})},22100:function(e,a,r){r.d(a,{V:()=>p});var t=r(27378),s=r(44072),l=r(70233);let o="cancelled",n=()=>({progress:0,status:"queued",error:void 0,response:void 0,wasCancelled:!1,cancelFn:void 0}),d=(e,a)=>{switch(a.type){case"queueUpload":return{...e,uploads:new Map(e.uploads).set(a.payload.file,{...e.uploads.get(a.payload.file)||n(),status:"queued",cancelFn:a.payload.cancelFn})};case"updateUploadProgress":return{...e,uploads:new Map(e.uploads).set(a.payload.file,{...e.uploads.get(a.payload.file)||n(),progress:a.payload.progress||0,status:"inProgress"})};case"finishUploadSuccessfully":return{...e,uploads:new Map(e.uploads).set(a.payload.file,{...e.uploads.get(a.payload.file)||n(),status:"complete",response:a.payload.response})};case"finishUploadWithError":return{...e,uploads:new Map(e.uploads).set(a.payload.file,{...e.uploads.get(a.payload.file)||n(),status:"complete",error:a.payload.error,wasCancelled:a.payload.error?.message===o})};case"removeUpload":{let r=new Map(e.uploads);return r.delete(a.payload.file),{...e,uploads:r}}default:throw Error()}},i=()=>({uploads:new Map}),p=e=>{let{parallel:a,uploadFn:r,onSuccess:n,onError:p}=e,[u,c]=t.useReducer(d,i());return{uploads:u.uploads,handleUpload:e=>{let t=[];for(let a=0;a<e.length;a++){let r=e[a],d=new FormData;d.set(s.TB,r);let i=l.Z.CancelToken.source(),u={headers:{"X-Requested-With":"XMLHttpRequest"},onUploadProgress:e=>{let a=e.total??1;c({type:"updateUploadProgress",payload:{file:r,progress:Math.round(e.loaded/a*100)}})},cancelToken:i.token};c({type:"queueUpload",payload:{file:r,cancelFn:i}});let h={formData:d,config:u,thenFn:e=>{c({type:"finishUploadSuccessfully",payload:{file:r,response:e}}),n&&n(e,r)},catchFn:e=>{c({type:"finishUploadWithError",payload:{file:r,error:e}}),e.message!==o&&p&&p(e,r)}};t.push(h)}if(a)for(let e of t)r(e.formData,e.config).then(e.thenFn).catch(e.catchFn);else t.reduce(async(e,a)=>(await e,r(a.formData,a.config).then(a.thenFn).catch(a.catchFn)),Promise.resolve())},handleCancelUpload:e=>{u.uploads.get(e)?.cancelFn?.cancel(o)},handleRemoveUpload:e=>{c({type:"removeUpload",payload:{file:e}})}}}},64630:function(e,a,r){r.r(a),r.d(a,{default:()=>M});var t=r(24246),s=r(45043),l=r(25236),o=r(25645),n=r(31757),d=r(51527),i=r(4075),p=r(27090),u=r(75165),c=r(24787),h=r(90359),y=r(60787),g=r(99915),f=r(27378),m=r(92369),v=r(21714),x=r(40270),j=r(23056),F=r(91057),U=r(84335),q=r(13754),b=r(98713),w=r(81211),T=r(45882),P=r(22621),C=r(416);let E=e=>{let{uploads:a,handleUpload:r,handleRemoveUpload:s,extractSuccessMessage:l,extractErrorMessage:o}=e,[n,d]=f.useState(!1),[i,p]=f.useState("inProgress"),[u,c]=f.useState([]);!n&&a.size>0&&d(!0),f.useEffect(()=>{let e=Array.from(a.values());e.some(e=>"inProgress"===e.status)?p("inProgress"):e.every(e=>"complete"===e.status)?p("success"):p("danger")},[a]);let h=e=>{for(let a of e)s(a)},y=Array.from(a.values()).filter(e=>e.response).length;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(m.o,{onFileDrop:(e,a)=>{r(a)},dropzoneProps:{accept:{"application/xml":[".json",".bz2",".gz"]},onDropRejected:e=>{c(e)},useFsAccessApi:!1},children:[(0,t.jsx)(v.Y,{titleIcon:(0,t.jsx)(C.ZP,{}),titleText:"Drag and drop files here",titleTextSeparator:"or",infoText:"Accepted file types: .json, .bz2, .gz"}),n&&(0,t.jsx)(x.M,{statusToggleText:`${y} of ${a.size} files uploaded`,statusToggleIcon:i,children:Array.from(a.entries()).map((e,a)=>{let[r,s]=e;return(0,t.jsx)(j.B,{className:s.progress<100||!s.response?"multiple-file-upload-status-item-force-blue":void 0,fileIcon:(0,t.jsx)(P.ZP,{}),file:r,onClearClick:()=>h([r]),progressValue:s.progress,progressVariant:s.error?"danger":s.response?"success":void 0,progressHelperText:s.error?(0,t.jsx)(F.p,{isLiveRegion:!0,children:(0,t.jsx)(U.u,{variant:"error",children:o(s.error)})}):100!==s.progress||s.response?s.response?(0,t.jsx)(F.p,{isLiveRegion:!0,children:(0,t.jsx)(U.u,{variant:"default",children:l(s.response)})}):void 0:(0,t.jsx)(F.p,{isLiveRegion:!0,children:(0,t.jsxs)(U.u,{variant:"warning",children:[(0,t.jsx)(q.$,{isInline:!0}),"File uploaded. Waiting for the server to process it."]})})},`${r.name}-${a}`)})}),(0,t.jsx)(b.u,{isOpen:u.length>0,title:"Unsupported files",titleIconVariant:"warning",showClose:!0,"aria-label":"unsupported file upload attempted",onClose:()=>c([]),variant:"small",children:(0,t.jsx)(w.aV,{children:u.map(e=>(0,t.jsx)(T.H,{children:e.file.name},e.file.name))})})]})})},M=()=>{let{uploads:e,handleUpload:a,handleRemoveUpload:r}=(0,g.km)(),{uploads:f,handleUpload:m,handleRemoveUpload:v}=(0,y.tG)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.NP,{variant:s.Dk.light,children:(0,t.jsx)(l.D,{children:(0,t.jsx)(o.x,{component:"h1",children:"Upload"})})}),(0,t.jsx)(s.NP,{children:(0,t.jsx)(n.Z,{children:(0,t.jsx)(d.e,{children:(0,t.jsxs)(i.m,{defaultActiveKey:0,children:[(0,t.jsx)(p.O,{eventKey:0,title:(0,t.jsx)(u.T,{children:"SBOM"}),children:(0,t.jsx)(c.I,{id:"upload-sbom-tab-content",children:(0,t.jsx)(h.H,{hasPadding:!0,children:(0,t.jsx)(E,{uploads:e,handleUpload:a,handleRemoveUpload:r,extractSuccessMessage:e=>`${e.data.document_id} uploaded`,extractErrorMessage:e=>e.response?.data?e.message:"Error while uploading file"})})})}),(0,t.jsx)(p.O,{eventKey:1,title:(0,t.jsx)(u.T,{children:"Advisory"}),children:(0,t.jsx)(c.I,{id:"upload-advisory-tab-content",children:(0,t.jsx)(h.H,{hasPadding:!0,children:(0,t.jsx)(E,{uploads:f,handleUpload:m,handleRemoveUpload:v,extractSuccessMessage:e=>`${e.data.document_id} uploaded`,extractErrorMessage:e=>e.response?.data?e.message:"Error while uploading file"})})})})]})})})})]})}},60787:function(e,a,r){r.d(a,{N7:()=>u,gw:()=>c,tG:()=>h});var t=r(1183),s=r(68e3),l=r(22285),o=r(54227),n=r(54774),d=r(94426),i=r(22100);let p="advisories",u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{data:r,isLoading:s,error:n,refetch:i}=(0,t.a)({queryKey:[p,e],queryFn:()=>(0,o.A1)({client:l.L,query:{...(0,d.rm)(e)}}),enabled:!a});return{result:{data:r?.data?.items||[],total:r?.data?.total??0,params:e??e},isFetching:s,fetchError:n||null,refetch:i}},c=e=>{let{data:a,isLoading:r,error:s}=(0,t.a)({queryKey:[p,e],queryFn:()=>(0,o.pB)({client:l.L,path:{key:e}}),enabled:void 0!==e});return{advisory:a?.data,isFetching:r,fetchError:s}},h=()=>{let e=(0,s.NL)();return(0,i.V)({parallel:!0,uploadFn:(e,a)=>(0,n.Cu)(e,a),onSuccess:()=>{e.invalidateQueries({queryKey:[p]})}})}},99915:function(e,a,r){r.d(a,{Fz:()=>c,KQ:()=>f,Oh:()=>g,km:()=>y,p4:()=>h,uz:()=>m});var t=r(1183),s=r(68e3),l=r(16072),o=r(22285),n=r(54227),d=r(22100),i=r(54774),p=r(94426);let u="sboms",c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{data:r,isLoading:s,error:l,refetch:d}=(0,t.a)({queryKey:[u,e],queryFn:()=>(0,n.Wp)({client:o.L,query:{...(0,p.rm)(e)}}),enabled:!a});return{result:{data:r?.data?.items||[],total:r?.data?.total??0,params:e??e},isFetching:s,fetchError:l,refetch:d}},h=e=>{let{data:a,isLoading:r,error:s}=(0,t.a)({queryKey:[u,e],queryFn:()=>void 0===e?Promise.resolve(void 0):(0,n._Q)({client:o.L,path:{id:e}}),enabled:void 0!==e});return{sbom:a?.data,isFetching:r,fetchError:s}},y=()=>{let e=(0,s.NL)();return(0,d.V)({parallel:!0,uploadFn:(e,a)=>(0,i.Hb)(e,a),onSuccess:()=>{e.invalidateQueries({queryKey:[u]})}})},g=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:r,isLoading:s,error:l,refetch:d}=(0,t.a)({queryKey:["SBOMsQueryKeysss","by-package",e,a],queryFn:()=>(0,n.DU)({client:o.L,query:{purl:e,...(0,p.rm)(a)}})});return{result:{data:r?.data?.items||[],total:r?.data?.total??0,params:a??a},isFetching:s,fetchError:l,refetch:d}},f=e=>{let{data:a,isLoading:r,error:s}=(0,t.a)({queryKey:[u,e,"advisory"],queryFn:()=>(0,n.NU)({client:o.L,path:{id:e}})});return{advisories:a?.data||[],isFetching:r,fetchError:s}},m=e=>{let a=(0,l.h)({queries:e.map(e=>({queryKey:[u,e,"advisory"],queryFn:()=>(0,n.NU)({client:o.L,path:{id:e}})}))});return{advisories:a.map(e=>{let{data:a}=e;return a?.data||[]}),isFetching:a.some(e=>{let{isLoading:a}=e;return a}),fetchError:a.map(e=>{let{error:a}=e;return a})}}}}]);