"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([["46"],{92934:function(e,i,t){t.d(i,{F:()=>c,P:()=>u});var l=t(24246),r=t(27378),s=t(74502),a=t(32947),n=t(14629),o=t(49988),d=t(17598);let u=r.createContext({}),c=e=>{let{children:i}=e,[t,c]=r.useState(""),[y,v]=r.useState("");r.useEffect(()=>{let e=setTimeout(()=>{v(t)},400);return()=>clearTimeout(e)},[t]);let{labels:h}=(0,d.useFetchAdvisoryLabels)(y),m=(0,o.vZ)({tableName:"advisory",persistenceKeyPrefix:s.yq.advisories,persistTo:"urlParams",columnNames:{identifier:"ID",title:"Title",severity:"Aggregated Severity",type:"Type",labels:"Labels",modified:"Revision",vulnerabilities:"Vulnerabilities"},isPaginationEnabled:!0,isSortEnabled:!0,sortableColumns:["identifier","severity","modified"],initialSort:{columnKey:"modified",direction:"desc"},isFilterEnabled:!0,filterCategories:[{categoryKey:s.L4,title:"Filter text",placeholderText:"Search",type:n.vA.search},{categoryKey:"average_severity",title:"Severity",placeholderText:"Severity",type:n.vA.multiselect,selectOptions:[{value:"null",label:"Unknown"},{value:"none",label:"None"},{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"critical",label:"Critical"}]},{categoryKey:"modified",title:"Revision",type:n.vA.dateRange},{categoryKey:"labels",title:"Label",type:n.vA.autocompleteLabel,placeholderText:"Filter results by label",selectOptions:h.map(e=>{let i=(0,a.W)({key:e.key,value:e.value});return{value:i,label:i}}),onInputValueChange:c}],isExpansionEnabled:!1}),{result:{data:p,total:b},isFetching:x,fetchError:f}=(0,d.useFetchAdvisories)((0,o.QO)({...m,hubSortFieldKeys:{identifier:"identifier",severity:"average_score",modified:"modified"}}),(m.filterState.filterValues.labels??[]).map(e=>(0,a.nE)(e))),j=(0,o.KC)({...m,idProperty:"identifier",currentPageItems:p,totalItemCount:b,isLoading:x});return(0,l.jsx)(u.Provider,{value:{totalItemCount:b,isFetching:x,fetchError:f,tableControls:j},children:i})}},26179:function(e,i,t){t.d(i,{H:()=>S});var l=t(24246),r=t(27378),s=t(65783),a=t(79551),n=t(32489),o=t(90519),d=t(4835),u=t(14350),c=t(11165),y=t(89330),v=t(31423),h=t(94154),m=t(88935),p=t(3804),b=t(31336),x=t(73227),f=t(7615),j=t(57524),g=t(49304),T=t(63706),K=t(32947),C=t(73827),w=t(92934),L=t(15167);let S=()=>{let{isFetching:e,fetchError:i,totalItemCount:t,tableControls:S}=r.useContext(w.P),[F,A]=r.useState(null),E=null!==F,{numRenderedColumns:k,currentPageItems:_,propHelpers:{paginationProps:q,tableProps:P,getThProps:D,getTrProps:I,getTdProps:N},expansionDerivedState:{isCellExpanded:O},filterState:{filterValues:Q,setFilterValues:V}}=S,{downloadAdvisory:R}=(0,x.useDownload)(),$=()=>{A(null)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(d.i,{...P,"aria-label":"advisory-table",children:[(0,l.jsx)(u.h,{children:(0,l.jsx)(c.Tr,{children:(0,l.jsxs)(b.qK,{...S,children:[(0,l.jsx)(y.Th,{...D({columnKey:"identifier"})}),(0,l.jsx)(y.Th,{...D({columnKey:"title"})}),(0,l.jsx)(y.Th,{...D({columnKey:"severity"}),info:{tooltip:"The average CVSS score for all of the Vulnerabilities linked to this Advisory."}}),(0,l.jsx)(y.Th,{...D({columnKey:"type"})}),(0,l.jsx)(y.Th,{...D({columnKey:"labels"})}),(0,l.jsx)(y.Th,{...D({columnKey:"modified"})}),(0,l.jsx)(y.Th,{...D({columnKey:"vulnerabilities"})})]})})}),(0,l.jsx)(b.hp,{isLoading:e,isError:!!i,isNoData:0===t,numRenderedColumns:k,children:_.map((e,i)=>{let t=e.vulnerabilities.reduce((e,i)=>{let t=(0,f.g)(i.severity);return Object.assign(e,{[t]:e[t]+1})},{critical:0,high:0,medium:0,low:0,none:0,unknown:0});return(0,l.jsx)(v.p,{isExpanded:O(e),children:(0,l.jsx)(c.Tr,{...I({item:e}),children:(0,l.jsxs)(b.Cx,{...S,item:e,rowIndex:i,children:[(0,l.jsx)(h.Td,{width:15,modifier:"breakWord",...N({columnKey:"identifier",isCompoundExpandToggle:!0,item:e,rowIndex:i}),children:(0,l.jsx)(s.OL,{to:`/advisories/${e.uuid}`,children:e.document_id})}),(0,l.jsx)(h.Td,{width:30,modifier:"truncate",...N({columnKey:"title"}),children:e.title}),(0,l.jsx)(h.Td,{width:15,modifier:"truncate",...N({columnKey:"severity"}),children:e.average_severity&&(0,l.jsx)(j.o,{value:(0,f.g)(e.average_severity),score:e.average_score,showLabel:!0,showScore:!0})}),(0,l.jsx)(h.Td,{width:10,...N({columnKey:"type"}),children:e.labels.type}),(0,l.jsx)(h.Td,{width:10,...N({columnKey:"labels"}),children:(0,l.jsx)(C.C,{value:e.labels,onClick:e=>{let{key:i,value:t}=e,l=(0,K.W)({key:i,value:t}),r=Q.labels;if(!r?.includes(l)){let e=r?[...r,l]:[l];V({...Q,labels:e})}}})}),(0,l.jsx)(h.Td,{width:10,modifier:"truncate",...N({columnKey:"modified"}),children:(0,T.p6)(e.modified)}),(0,l.jsx)(h.Td,{width:10,...N({columnKey:"vulnerabilities"}),children:(0,l.jsx)(g.u,{severities:t})}),(0,l.jsx)(h.Td,{isActionCell:!0,children:(0,l.jsx)(m.k,{items:[{title:"Edit labels",onClick:()=>{A(e)}},{isSeparator:!0},{title:"Download",onClick:()=>{R(e.uuid,`${e.identifier}.json`)}}]})})]})})},e.identifier)})})]}),(0,l.jsx)(p.p,{idPrefix:"advisory-table",isTop:!1,paginationProps:q}),(0,l.jsxs)(a.u,{isOpen:E,variant:"medium",onClose:$,children:[(0,l.jsx)(n.x,{title:"Edit labels"}),(0,l.jsx)(o.f,{children:F&&(0,l.jsx)(L.q,{advisory:F,onClose:$})})]})]})}},80475:function(e,i,t){t.d(i,{P:()=>c});var l=t(24246),r=t(27378),s=t(70715),a=t(40982),n=t(89226),o=t(14629),d=t(3804),u=t(92934);let c=e=>{let{showFilters:i}=e,{tableControls:t}=r.useContext(u.P),{propHelpers:{toolbarProps:c,filterToolbarProps:y,paginationToolbarItemProps:v,paginationProps:h}}=t;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(s.o,{...c,children:(0,l.jsxs)(a.c,{children:[i&&(0,l.jsx)(o.Ki,{...y}),(0,l.jsx)(n.E,{...v,children:(0,l.jsx)(d.p,{idPrefix:"advisory-table",isTop:!0,paginationProps:h})})]})})})}},15167:function(e,i,t){t.d(i,{q:()=>o});var l=t(24246),r=t(27378),s=t(24502),a=t(15726),n=t(17598);let o=e=>{let{advisory:i,onClose:t}=e,{pushNotification:o}=r.useContext(a.c),[d,u]=r.useState(""),[c,y]=r.useState(""),{labels:v}=(0,n.useFetchAdvisoryLabels)(c);r.useEffect(()=>{let e=setTimeout(()=>{y(d)},400);return()=>clearTimeout(e)},[d]);let{mutate:h,isPending:m}=(0,n.useUpdateAdvisoryLabelsMutation)(()=>{o({title:`Labels updated for Advisory ${i.document_id}`,variant:"success"}),t()},e=>{o({title:`Error while updating labels for Advisory ${i.document_id}`,variant:"danger"})});return(0,l.jsx)(s.M,{title:`Labels of Advisory: ${i.document_id}`,value:i.labels,isDisabled:m,onSave:e=>{h({id:i.uuid,labels:e})},onClose:t,onInputChange:u,options:v})}},17598:function(e,i,t){t.d(i,{useFetchAdvisories:()=>h,useFetchAdvisoryById:()=>m,useFetchAdvisoryLabels:()=>v,useUpdateAdvisoryLabelsMutation:()=>b,useUploadAdvisory:()=>p});var l=t(1183),r=t(24038),s=t(68e3),a=t(75503),n=t(50576),o=t(40371),d=t(87017),u=t(49988),c=t(95169);let y="advisories",v=e=>{let{data:i,isLoading:t,error:s,refetch:a}=(0,l.useQuery)({queryKey:[y,"labels",e],queryFn:()=>(0,o.sf)({client:n.L,query:{limit:10,filter_text:e}}),placeholderData:r.Wk});return{labels:i?.data||[],isFetching:t,fetchError:s,refetch:a}},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{q:r,...s}=(0,u.rm)(e),a=(0,u.Rb)(i),{data:d,isLoading:c,error:v,refetch:h}=(0,l.useQuery)({queryKey:[y,e,a],queryFn:()=>(0,o.A1)({client:n.L,query:{...s,q:[r,a].filter(e=>e).join("&")}}),enabled:!t});return{result:{data:d?.data?.items||[],total:d?.data?.total??0,params:e??e},isFetching:c,fetchError:v||null,refetch:h}},m=e=>{let{data:i,isLoading:t,error:r}=(0,l.useQuery)({queryKey:[y,e],queryFn:()=>(0,o.pB)({client:n.L,path:{key:e}}),enabled:void 0!==e});return{advisory:i?.data,isFetching:t,fetchError:r}},p=()=>{let e=(0,s.NL)();return(0,c.V)({parallel:!0,uploadFn:(e,i)=>(0,d.Cu)(e,i),onSuccess:async()=>{await e.invalidateQueries({queryKey:[y]})}})},b=(e,i)=>{let t=(0,s.NL)();return(0,a.D)({mutationFn:e=>(0,o.m5)({client:n.L,path:{id:e.id},body:e.labels}),onSuccess:async(i,l)=>{e(),await t.invalidateQueries({queryKey:[y]})},onError:i})}}}]);